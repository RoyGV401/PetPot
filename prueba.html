<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recorte de imagen</title>
          <!-- Bootstrap CSS -->
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
          <!-- Cropper.js CSS -->
          <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
          <link rel="stylesheet" href="scss/custom.css" />
            <link rel="stylesheet" href="reusable_styles.css" />
            <link rel="stylesheet" href="style_adopcion.css" />
          
            <link rel="stylesheet" href="mystyle.css" />
            <link
               rel="icon"
               type="image/png"
               sizes="32x32"
               href="resources/favicon.png"
               data-href-light="favicon-32x32.png"
               data-href-dark="favicon-32x32-dark.png"
            />
            <script type="module" src="scripts/adopcion.js"></script>
            <script src="modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        #imagePreview {
            max-width: 100%;
        }
        .cropper-container {
            margin: 0 auto;
        }
        .cropper-modal {
            background: rgba(0, 0, 0, 0.5);
        }
        .cropper-view-box {
            outline: 2px solid #39f;
            outline-color: rgba(51, 153, 255, 0.75);
        }
        .cropper-dashed {
            border: 0 dashed #eee;
        }
        .cropper-face {
            background-color: transparent;
        }
        .cropper-point {
            background-color: #39f;
            width: 10px;
            height: 10px;
            opacity: 1;
        }
        .cropper-line {
            background-color: #39f;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-6">
                <!-- Formulario existente -->
                <div class="mb-3">
                    <label class="form-label">Nombre:</label>
                    <input type="text" class="form-control" placeholder="Nombre">
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Sexo:</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="sexo" id="macho">
                        <label class="form-check-label" for="macho">Macho</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="sexo" id="hembra">
                        <label class="form-check-label" for="hembra">Hembra</label>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <!-- Área de carga y recorte -->
                <div class="mb-3">
                    <label for="formFile" class="form-label">Foto del animal</label>
                    <input class="form-control" type="file" id="formFile" accept="image/*">
                    
                    <div class="mt-3 border rounded" style="background-color: #f8f9fa;">
                        <div class="img-container" style="max-height: 400px; overflow: hidden;">
                            <img id="imagePreview" src="#" alt="Vista previa" style="display: none; max-width: 100%;">
                        </div>
                        <small id="previewText" class="text-muted d-block p-2">Seleccione una imagen para recortar</small>
                    </div>
                    
                    <div class="mt-3 text-center" id="cropperControls" style="display: none;">
                        <div class="bg-light p-3 rounded">
                            <p class="mb-2"><strong>Crop image</strong></p>
                            <p class="small text-muted mb-3">Mueva el cuadro para seleccionar el área deseada</p>
                            <button id="cancelCrop" class="btn btn-outline-secondary me-2">Cancelar</button>
                            <button id="cropButton" class="btn btn-primary">Recortar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS + Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Cropper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    
    <script>
        let cropper;
        const imagePreview = document.getElementById('imagePreview');
        const fileInput = document.getElementById('formFile');
        const previewText = document.getElementById('previewText');
        const cropperControls = document.getElementById('cropperControls');
        
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            
            if (file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    previewText.style.display = 'none';
                    
                    // Inicializar Cropper.js
                    if (cropper) {
                        cropper.destroy();
                    }
                    
                    cropper = new Cropper(imagePreview, {
                        aspectRatio: 453 / 313,
                        viewMode: 1,
                        autoCropArea: 0.8, // Área inicial del 80%
                        responsive: true,
                        movable: true,
                        scalable: true,
                        zoomable: true,
                        rotatable: false,
                        cropBoxMovable: true,
                        cropBoxResizable: true,
                        toggleDragModeOnDblclick: false,
                        ready() {
                            cropperControls.style.display = 'block';
                        }
                    });
                }
                
                reader.readAsDataURL(file);
            }
        });
        
        document.getElementById('cropButton').addEventListener('click', function() {
            if (cropper) {
                // Obtener el canvas recortado con el tamaño exacto
                const canvas = cropper.getCroppedCanvas({
                    width: 453,
                    height: 313,
                    minWidth: 453,
                    minHeight: 313,
                    maxWidth: 453,
                    maxHeight: 313,
                    fillColor: '#fff'
                });
                
                // Convertir a blob y actualizar el input file
                canvas.toBlob((blob) => {
                    const file = new File([blob], 'imagen_recortada.png', { type: 'image/png' });
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    fileInput.files = dataTransfer.files;
                    
                    // Mostrar resultado final
                    imagePreview.src = canvas.toDataURL();
                    cropper.destroy();
                    cropperControls.style.display = 'none';
                    
                    // Mostrar mensaje de éxito
                    previewText.textContent = 'Imagen recortada lista (453×313 px)';
                    previewText.className = 'text-success d-block p-2';
                    previewText.style.display = 'block';
                }, 'image/png');
            }
        });
        
        document.getElementById('cancelCrop').addEventListener('click', function() {
            if (cropper) {
                cropper.destroy();
                imagePreview.style.display = 'none';
                fileInput.value = '';
                cropperControls.style.display = 'none';
                previewText.textContent = 'Seleccione una imagen para recortar';
                previewText.className = 'text-muted d-block p-2';
                previewText.style.display = 'block';
            }
        });
    </script>
</body>
</html>